#!/bin/bash
function usage {
    echo "
    Usage:script_name dc_case_list.f
    Options:
        -h,--help:help
        -f,--file:the path of dc_case_list.f
        -m,--max_process:num of concurrent processes. Default value is 4"
}
max_process=4
while [ -n "$1" ]; do
    case "$1" in
        -h|--help)
            usage
            exit ;;
        -f|--file)
            list_file="$2"
            shift 2;;
        -m|--max_process)
            max_process="$2"
            shift 2;;
        --)
            shift
            break ;;
		*)
			echo "$1 is not a valid option"
			exit 1 ;;
		esac
done

if [ ! -e "$list_file" ]; then
    echo "file $list_file not exist, please check the path"
    exit
fi

xargs -P "$max_process" -I {} sh -c '
    tcl_file="{}"
    output_file="$(dirname "{}")/dc_output/dc.log"
    dc_shell -f $tcl_file -output_log_file $output_file
' _ < $list_file

split_file.sh
#!/bin/bash
if [ "$#" -ne 2 ]; then
    echo "Usage : $0 <list to split> <number of parts >"
    exit 1
fi

list="$1"
num_parts="$2"
base_name=$(basename "$list" .f)

echo $base_name

# echo "list is $list and num_parts is $num_parts"
if [ ! -f $list ]; then
    echo "File '$list' does not exist"
    exit 1
fi

lines=$(wc -l < "$list")
# echo "lines is $lines"
line_per_part=$(($lines / ${num_parts}))
# echo "line_per_part is $line_per_part"
for ((i=1; i<= $num_parts; i++)); do
    start_line=$((${i} * ${line_per_part} - ${line_per_part}+1))
    end_line=$((${i} * ${line_per_part}))
    # echo "Start_line is $start_line and end_line is $end_line"
    if [ $i -eq $num_parts ]; then
        end_line=$lines
    fi
    sed -n "${start_line},${end_line}p" "$list" > "${base_name}_${i}.f"
#     awk "{if ($start_line <= $1 && $1 <= $end_line) print}" "$list" > "${base_name}_${i}.f"
done
echo "file $list has been split"

批量并行转sgdc
sgdc_trance() {
    dir=$1
    log_file=$2
    if [ ! -e $log_file ]; then
        touch $log_file
    fi
    cd $dir
    #for dir in $(cat $file); do
    echo -e "\033[36m dir is $dir\033[0m"
    sgdc_name=$(find $dir -name "*.sgdc" -type f)
    if [ "$sgdc_name" == "" ]; then
        echo "22:dir is no sgdc file $dir" >> ${log_file}
    else
        /tmpdata/ranwu_staff_3/xycai/0928/c_scripts/runsgdc -s ${sgdc_name} -p $dir > /dev/null
        if [ $? != 0 ]; then
            echo "11:trans may failed $sgdc_name" >> ${log_file}
        fi
    fi
    #done
    cd ..
}
cast_list=$1
process_num=8
if [ ! -e $log_file ]; then
    touch $log_file
fi
export -f sgdc_trance
xargs -P "$process_num" -I {} sh -c '
    caseLists="{}"
    output_file="/tmpdata/ranwu_staff_3/xycai/work/newcase/CDC_case/aa.log"
    sgdctrance "$caseLists" "$output_file"
' < ${cast_list}
