#!/bin/bash
function usage {
    echo "
    Usage:script_name dc_case_list.f
    Options:
        -h,--help:help
        -f,--file:the path of dc_case_list.f
        -m,--max_process:num of concurrent processes. Default value is 4"
}
max_process=4
while [ -n "$1" ]; do
    case "$1" in
        -h|--help)
            usage
            exit ;;
        -f|--file)
            list_file="$2"
            shift 2;;
        -m|--max_process)
            max_process="$2"
            shift 2;;
        --)
            shift
            break ;;
		*)
			echo "$1 is not a valid option"
			exit 1 ;;
		esac
done

if [ ! -e "$list_file" ]; then
    echo "file $list_file not exist, please check the path"
    exit
fi

xargs -P "$max_process" -I {} sh -c '
    tcl_file="{}"
    output_file="$(dirname "{}")/dc_output/dc.log"
    dc_shell -f $tcl_file -output_log_file $output_file
' _ < $list_file
