#!/bin/bash
function usage {
    echo "
    Usage:script_name dc_case_list.f
    Options:
        -h,--help:help
        -f,--file:the path of dc_case_list.f
        -m,--max_process:num of concurrent processes. Default value is 4"
}
max_process=4
while [ -n "$1" ]; do
    case "$1" in
        -h|--help)
            usage
            exit ;;
        -f|--file)
            list_file="$2"
            shift 2;;
        -m|--max_process)
            max_process="$2"
            shift 2;;
        --)
            shift
            break ;;
		*)
			echo "$1 is not a valid option"
			exit 1 ;;
		esac
done

if [ ! -e "$list_file" ]; then
    echo "file $list_file not exist, please check the path"
    exit
fi

xargs -P "$max_process" -I {} sh -c '
    tcl_file="{}"
    output_file="$(dirname "{}")/dc_output/dc.log"
    dc_shell -f $tcl_file -output_log_file $output_file
' _ < $list_file

split_file.sh
#!/bin/bash
if [ "$#" -ne 2 ]; then
    echo "Usage : $0 <list to split> <number of parts >"
    exit 1
fi

list="$1"
num_parts="$2"
base_name=$(basename "$list" .f)

echo $base_name

# echo "list is $list and num_parts is $num_parts"
if [ ! -f $list ]; then
    echo "File '$list' does not exist"
    exit 1
fi

lines=$(wc -l < "$list")
# echo "lines is $lines"
line_per_part=$(($lines / ${num_parts}))
# echo "line_per_part is $line_per_part"
for ((i=1; i<= $num_parts; i++)); do
    start_line=$((${i} * ${line_per_part} - ${line_per_part}+1))
    end_line=$((${i} * ${line_per_part}))
    # echo "Start_line is $start_line and end_line is $end_line"
    if [ $i -eq $num_parts ]; then
        end_line=$lines
    fi
    sed -n "${start_line},${end_line}p" "$list" > "${base_name}_${i}.f"
#     awk "{if ($start_line <= $1 && $1 <= $end_line) print}" "$list" > "${base_name}_${i}.f"
done
echo "file $list has been split"
